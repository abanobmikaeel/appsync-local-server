<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Sources - appsync-local</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <nav>
    <div class="nav-container">
      <a href="index.html" class="logo">appsync-local</a>
      <div class="nav-links">
        <a href="getting-started.html">Getting Started</a>
        <a href="configuration.html">Configuration</a>
        <a href="data-sources.html">Data Sources</a>
        <a href="https://github.com/abanobmikaeel/appsync-local" target="_blank">GitHub</a>
      </div>
    </div>
  </nav>

  <main>
    <div class="doc-content">
      <h1>Data Sources</h1>
      <p>appsync-local supports multiple data source types that mirror AWS AppSync capabilities.</p>

      <h2>DynamoDB</h2>
      <p>Connect to local or remote DynamoDB tables. Use <code>@aws-appsync/utils/dynamodb</code> helpers for cleaner code.</p>

      <h3>Configuration</h3>
      <pre><code>{
  "name": "UsersTable",
  "type": "DYNAMODB",
  "config": {
    "tableName": "Users",
    "region": "us-east-1",
    "endpoint": "http://localhost:8000",  // Optional: for DynamoDB Local
    "accessKeyId": "fakeId",              // Optional: for DynamoDB Local
    "secretAccessKey": "fakeSecret"       // Optional: for DynamoDB Local
  }
}</code></pre>

      <h3>Running DynamoDB Locally</h3>
      <p><strong>With Docker:</strong></p>
      <pre><code>docker run -p 8000:8000 amazon/dynamodb-local</code></pre>

      <p><strong>With Java (no Docker):</strong></p>
      <pre><code># Download
curl -sL "https://d1ni2b6xgvw0s0.cloudfront.net/v2.x/dynamodb_local_latest.tar.gz" | tar -xz -C ~/dynamodb-local

# Run
java -jar ~/dynamodb-local/DynamoDBLocal.jar -sharedDb -port 8000</code></pre>

      <h3>Using @aws-appsync/utils/dynamodb Helpers</h3>
      <p>The recommended way to write DynamoDB resolvers. The table name is automatically injected from your data source config.</p>
      <pre><code>import { get, put, scan, query, remove } from '@aws-appsync/utils/dynamodb';
import { util } from '@aws-appsync/utils';

// List all items
export function request(ctx) {
  return scan({});  // TableName injected automatically!
}

// Get single item
export function request(ctx) {
  return get({ key: { id: ctx.arguments.id } });
}

// Create item
export function request(ctx) {
  return put({
    key: { id: util.autoId() },
    item: {
      name: ctx.arguments.input.name,
      createdAt: util.time.nowISO8601()
    }
  });
}

// Query with filter
export function request(ctx) {
  return query({
    query: { pk: { eq: ctx.arguments.userId } },
    filter: { status: { eq: 'active' } },
    limit: 20
  });
}</code></pre>

      <h3>Available DynamoDB Helpers</h3>
      <ul>
        <li><code>get({ key })</code> - Get a single item</li>
        <li><code>put({ key, item })</code> - Create or replace an item</li>
        <li><code>update({ key, update })</code> - Update specific attributes</li>
        <li><code>remove({ key })</code> - Delete an item</li>
        <li><code>query({ query, filter, limit })</code> - Query by key condition</li>
        <li><code>scan({ filter, limit })</code> - Scan all items</li>
        <li><code>batchGet()</code>, <code>batchPut()</code>, <code>batchDelete()</code> - Batch operations</li>
        <li><code>transactGet()</code>, <code>transactWrite()</code> - Transactions</li>
        <li><code>operations.increment()</code>, <code>operations.append()</code>, etc. - Update helpers</li>
      </ul>

      <h3>Response Handling</h3>
      <pre><code>export function response(ctx) {
  // For get()
  return ctx.prev.result?.Item;

  // For scan()/query()
  return ctx.prev.result?.Items || [];

  // For update() with ReturnValues
  return ctx.prev.result?.Attributes;
}</code></pre>

      <h2>Lambda</h2>
      <p>Invoke Lambda functions (local JavaScript files).</p>

      <h3>Configuration</h3>
      <pre><code>{
  "name": "UserService",
  "type": "LAMBDA",
  "config": {
    "functionName": "userService",
    "file": "lambdas/userService.js",
    "region": "us-east-1"
  }
}</code></pre>

      <h3>Example Resolver</h3>
      <pre><code>export function request(ctx) {
  return {
    operation: 'Invoke',
    payload: {
      action: 'getUser',
      userId: ctx.arguments.id
    }
  };
}

export function response(ctx) {
  return ctx.result;
}</code></pre>

      <h3>Lambda Handler</h3>
      <pre><code>// lambdas/userService.js
export async function handler(event) {
  if (event.action === 'getUser') {
    return { id: event.userId, name: 'John Doe' };
  }
}</code></pre>

      <h2>HTTP</h2>
      <p>Make HTTP requests to external APIs.</p>

      <h3>Configuration</h3>
      <pre><code>{
  "name": "ExternalAPI",
  "type": "HTTP",
  "config": {
    "endpoint": "https://api.example.com"
  }
}</code></pre>

      <h3>Example Resolver</h3>
      <pre><code>export function request(ctx) {
  return {
    method: 'GET',
    resourcePath: `/users/${ctx.arguments.id}`,
    params: {
      headers: {
        'Authorization': `Bearer ${ctx.request.headers.authorization}`
      }
    }
  };
}

export function response(ctx) {
  return JSON.parse(ctx.result.body);
}</code></pre>

      <h2>RDS (PostgreSQL / MySQL)</h2>
      <p>Execute SQL queries against relational databases.</p>

      <h3>Configuration</h3>
      <pre><code>{
  "name": "PostgresDB",
  "type": "RDS",
  "config": {
    "engine": "postgresql",
    "mode": "local",
    "host": "localhost",
    "port": 5432,
    "user": "postgres",
    "password": "password",
    "databaseName": "mydb",
    "ssl": false
  }
}</code></pre>

      <h3>Supported Operations</h3>
      <ul>
        <li><code>executeStatement</code> - Execute a single SQL statement</li>
        <li><code>batchExecuteStatement</code> - Execute multiple statements</li>
        <li><code>beginTransaction</code> - Start a transaction</li>
        <li><code>commitTransaction</code> - Commit a transaction</li>
        <li><code>rollbackTransaction</code> - Rollback a transaction</li>
      </ul>

      <h3>Example Resolver</h3>
      <pre><code>export function request(ctx) {
  return {
    operation: 'executeStatement',
    sql: 'SELECT * FROM users WHERE id = :id',
    variableMap: {
      id: ctx.arguments.id
    }
  };
}

export function response(ctx) {
  return ctx.result.records[0];
}</code></pre>

      <h2>NONE</h2>
      <p>For resolvers that don't need a data source (local transformations).</p>

      <h3>Configuration</h3>
      <pre><code>{
  "name": "LocalResolver",
  "type": "NONE"
}</code></pre>

      <h3>Example Resolver</h3>
      <pre><code>export function request(ctx) {
  return {};
}

export function response(ctx) {
  return {
    timestamp: ctx.util.time.nowISO8601(),
    requestId: ctx.util.autoId()
  };
}</code></pre>
    </div>
  </main>

  <footer>
    <p>MIT License - <a href="https://github.com/abanobmikaeel/appsync-local">GitHub</a></p>
  </footer>
</body>
</html>
